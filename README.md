# Git Cherry Picker

Утилита для автоматизированного `cherry-pick` коммитов по списку задач в
хронологическом порядке (от старых к новым) с интерактивной обработкой
конфликтов.

## Состав

-   `git_cherry_picker.py` --- основной Python-скрипт
-   `git_find.sh` --- bash-обёртка для запуска по нескольким
    репозиториям
-   `tasks.txt` --- файл со списком задач

------------------------------------------------------------------------

## Как работает

1.  Получает список задач
2.  Находит коммиты в `source` ветке по `--grep`
3.  Исключает merge-коммиты
4.  Сортирует коммиты по времени
5.  Показывает список
6.  После подтверждения:
    -   переключается на `target`
    -   делает `pull`
    -   создаёт ветку `release/<version>`
    -   выполняет `git cherry-pick`
7.  При конфликте запускается интерактивное меню

------------------------------------------------------------------------

## Форматы задач

Поддерживаются:

    ECOLOGY-2994
    [ECOLOGY-2994]
    #1234

------------------------------------------------------------------------

## Использование

### Базовый запуск

    python3 git_cherry_picker.py <source> <target> <tasks> --release=<version>

Пример:

    python3 git_cherry_picker.py develop main ECOLOGY-2994 ECOLOGY-2995 --release=1.2.1

------------------------------------------------------------------------

### Использование файла задач

    python3 git_cherry_picker.py develop main tasks.txt --release=1.2.1

Формат `tasks.txt`:

    ECOLOGY-2994
    ECOLOGY-2995
    # комментарии игнорируются

------------------------------------------------------------------------

### Dry-run

    python3 git_cherry_picker.py develop main tasks.txt --release=1.2.1 --dry-run

------------------------------------------------------------------------

## Параметры

  Параметр     Описание
  ------------ -----------------------------
  source       Исходная ветка
  target       Целевая ветка
  tasks        Список задач или файл
  --release    Версия релиза (обязательно)
  --repo-dir   Путь к репозиторию
  --dry-run    Только показать коммиты
  --verbose    Подробный вывод

------------------------------------------------------------------------

## Обработка конфликтов

Меню действий при конфликте:

    (d)iff     — показать diff
    (l)ist     — список конфликтных файлов
    (c)ontinue — продолжить
    (u)ours    — взять изменения из текущей ветки
    (t)heirs   — взять изменения из коммита
    (m)anual   — открыть редактор
    (s)kip     — пропустить коммит
    (a)bort    — отменить процесс

После разрешения выполняется:

    git cherry-pick --continue --no-edit

------------------------------------------------------------------------

## Массовый запуск по репозиториям

В `git_find.sh` задаются:

    RELEASE_VER="1.2.1"
    SOURCE_BRANCH="test"
    TARGET_BRANCH="pre-prod"

И список репозиториев:

    REPOS=(
      "../eco-backend/"
      "../eco-auth/"
      "../eco-notifications/"
    )

Запуск:

    bash git_find.sh

------------------------------------------------------------------------

## Типичный workflow

1.  Обновить `tasks.txt`
2.  Проверить ветки
3.  Запустить `git_find.sh`
4.  Разрешить конфликты
5.  Проверить ветки `release/<version>`
6.  При необходимости отправить в origin

------------------------------------------------------------------------

## Требования

-   Python 3.8+
-   Git
-   Чистое рабочее дерево
